<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Ç™„É™„Ç∏„Éä„É´„ÅÆÈõ≤„Çí‰Ωú„Çç„ÅÜÔºÅ</title>
    <link rel="stylesheet" href="original.css">
</head>
<body>
    <button class="hamburger-menu">
        <span></span>
        <span></span>
        <span></span>
    </button>

    <nav class="nav-overlay">
        <ul>
            <li><a href="../index.html">„Éõ„Éº„É†</a></li>
            <li><a href="../collection/collection.html">„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥</a></li>
            <li><a href="original.html">„Ç™„É™„Ç∏„Éä„É´„ÅÆÈõ≤„Çí‰Ωú„Å£„Å¶„Åø„Çà„ÅÜ</a></li>
        </ul>
    </nav>
    <h1>„Ç™„É™„Ç∏„Éä„É´„ÅÆÈõ≤„Çí‰Ωú„Çç„ÅÜÔºÅ</h1>
    <div class="cloud-container">
        <div class="cloud-overlay" id="backGround"></div>
        <div class="cloud" id="mainCloud">Â•Ω„Åç„Å™ÂΩ¢„ÇíÈÅ∏„Çì„Åß„Å≠</div>
        <div class="cloud-overlay" id="overlayCloud"></div>
        <div class="cloud-overlay" id="overlayCloud2"></div>
    </div>
    <div class="button-container">
        <button class="back-button" id="backButton" onclick="goToPreviousPage()" style="display: none;">Êàª„Çã</button>
        <button class="decision-button" id="decisionButton" onclick="goToNextPage()">Ê±∫ÂÆö</button>
    </div>
    <div class="cloud-selection" id="cloudSelection">
        <div class="cloud-option cloud-shape-1" onclick="selectCloud('‚òÅ‚òÅ‚òÅ', this)">
            <img src="images/bottom1.PNG" alt="‰∏ã1">
        </div>
        <div class="cloud-option cloud-shape-2" onclick="selectCloud('‚òÅ‚òÅ‚òÅ‚òÅ', this)">
            <img src="images/bottom2.PNG" alt="‰∏ã2">
        </div>
        <div class="cloud-option cloud-shape-3" onclick="selectCloud('‚óè ‚óè ‚óè', this)">
            <img src="images/bottom3.PNG" alt="‰∏ã3">
        </div>
        <div class="cloud-option cloud-shape-4" onclick="selectCloud('‚óê', this)">
            <img src="images/bottom4.PNG" alt="‰∏ã4">
        </div>
    </div>
    <div class="modal-overlay" id="nameModal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ÂÆåÊàêÔºÅÔºÅ</h2>
                <a href="#" class="modal-close" onclick="document.getElementById('nameModal').style.display='none'; return false;">&times;</a>
            </div>
            <div class="modal-body">
                <p>‰Ωú„Å£„ÅüÈõ≤„Å´ÂêçÂâç„Çí„Å§„Åë„Å¶„Åø„Çà„ÅÜÔºÅ</p>
                <input type="text" id="cloudNameInput" placeholder="Èõ≤„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ" maxlength="20">
                <button class="modal-button" onclick="saveCloudName()">Ê±∫ÂÆö</button>
            </div>
        </div>
    </div>
    <div class="modal-overlay" id="completionModal" style="display: none;">
        <div class="modal-content completion-modal">
            <div class="modal-header">
                <h2>Èõ≤„ÅåÂÆåÊàê„Åó„Åæ„Åó„ÅüÔºÅ</h2>
                <a href="#" class="modal-close" onclick="closeCompletionModal(); return false;">&times;</a>
            </div>
            <div class="modal-body">
                <div class="completed-cloud-container">
                    <div class="completed-cloud" id="completedCloudDisplay">
                        <!-- ÂÆåÊàê„Åó„ÅüÈõ≤„ÅÆÁîªÂÉè„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                    </div>
                </div>
                <div class="cloud-name-display" id="cloudNameDisplay">
                    <!-- Èõ≤„ÅÆÂêçÂâç„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                </div>
                <div class="completion-buttons">
                    <button class="modal-button" onclick="restartCreation()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶‰Ωú„Çã</button>
                    <button class="modal-button" onclick="goToCollection()">„Ç≥„É¨„ÇØ„Ç∑„Éß„É≥„ÇíË¶ã„Çã</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let currentStep = 1;
        let selectedFirstCloud = null;
        let selectedFirstImage = null;
        let selectedSecondCloud = null;
        let selectedSecondImage = null;
        let selectedThirdCloud = null;
        let selectedThirdImage = null;
        let selectedFourthCloud = null; // „Åì„ÅÆË°å„ÇíËøΩÂä†
        let selectedFourthImage = null; // „Åì„ÅÆË°å„ÇíËøΩÂä†
        
        function selectCloud(cloudShape, element) {
            console.log('Cloud selected:', cloudShape);
            document.querySelectorAll('.cloud-option').forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            if (currentStep === 1) {
                const mainCloud = document.getElementById('mainCloud');
                const imgElement = element.querySelector('img');
                const imageSrc = imgElement.src;
                mainCloud.innerHTML = `<img src="${imageSrc}" alt="${cloudShape}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                mainCloud.classList.add('selected-shape');
                selectedFirstCloud = cloudShape;
                selectedFirstImage = imageSrc;
            } else if (currentStep === 2) {
                const overlayCloud = document.getElementById('overlayCloud');
                const imgElement = element.querySelector('img');
                const imageSrc = imgElement.src;
                overlayCloud.innerHTML = `<img src="${imageSrc}" alt="${cloudShape}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                overlayCloud.style.display = 'block';
                selectedSecondCloud = cloudShape;
                selectedSecondImage = imageSrc;
            } else if (currentStep === 3) {
                const overlayCloud2 = document.getElementById('overlayCloud2');
                const imgElement = element.querySelector('img');
                const imageSrc = imgElement.src;
                overlayCloud2.innerHTML = `<img src="${imageSrc}" alt="${cloudShape}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                overlayCloud2.style.display = 'block';
                selectedThirdCloud = cloudShape;
                selectedThirdImage = imageSrc;
            } else if (currentStep === 4) {
                const backGround = document.getElementById('backGround');
                const imgElement = element.querySelector('img');
                const imageSrc = imgElement.src;
                backGround.innerHTML = `<img src="${imageSrc}" alt="${cloudShape}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;  // backGround„Å´Ë®≠ÂÆö
                backGround.style.display = 'block';  // backGround„ÇíË°®Á§∫
                selectedFourthCloud = cloudShape;
                selectedFourthImage = imageSrc;
            } else {
                const backGround = document.getElementById('backGround');
                const imgElement = element.querySelector('img');
                const imageSrc = imgElement.src;
                overlayCloud.innerHTML = `<img src="${imageSrc}" alt="${cloudShape}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                overlayCloud.style.display = 'block';
            }
        }
        function goToNextPage() {
            console.log('GoToNextPage called, currentStep:', currentStep);
            if (currentStep === 1) {
                if (selectedFirstCloud === null) {
                    alert('„Éô„Éº„Çπ„ÅÆÈõ≤„ÅÆÂΩ¢„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                currentStep = 2;
                showSecondOptions();
            } else if (currentStep === 2) {
                if (selectedSecondCloud === null) {
                    alert('Áúü„Çì‰∏≠„ÅÆÈõ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                currentStep = 3;
                showThirdOptions();
            } else if (currentStep === 3) {
                if (selectedThirdCloud === null) {
                    alert('„Éà„ÉÉ„Éó„ÅÆÈõ≤„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                    return;
                }
                currentStep = 4;
                showFourthOptions();
            } else {
                showNameModal();
            }
        }
        function showNameModal() {
            const modal = document.getElementById('nameModal');
            modal.style.display = 'flex';
            document.getElementById('cloudNameInput').focus();
        }
        function saveCloudName() {
            const cloudName = document.getElementById('cloudNameInput').value;
            if (cloudName.trim() === '') {
                alert('Èõ≤„ÅÆÂêçÂâç„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            alert(`„Äå${cloudName}„Äç„Å®„ÅÑ„ÅÜÂêçÂâç„ÅÆÈõ≤„ÅåÂÆåÊàê„Åó„Åæ„Åó„ÅüÔºÅ`);
            const modal = document.getElementById('nameModal');
            modal.style.display = 'none';
        }
        document.addEventListener('DOMContentLoaded', function() {
            const input = document.getElementById('cloudNameInput');
            if (input) {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        saveCloudName();
                    }
                });
            }
        });
        function goToPreviousPage() {
            console.log('GoToPreviousPage called', currentStep);
            if (currentStep === 4) {
                currentStep = 3;
                document.getElementById('backGround').style.display = 'none';
                showThirdOptions();
            } else if (currentStep === 3) {
                currentStep = 2;
                document.getElementById('overlayCloud2').style.display = 'none';
                showSecondOptions();
            } else if (currentStep === 2) {
                currentStep = 1;
                document.getElementById('overlayCloud').style.display = 'none';
                showFirstOptions();
            }
        }
        function showSecondOptions() {
            console.log('ShowSecondOptions called');
            const decisionButton = document.getElementById('decisionButton');
            decisionButton.textContent = 'Ê±∫ÂÆö';
            decisionButton.classList.remove('complete-button');
            const backButton = document.getElementById('backButton');
            backButton.style.display = 'inline-block';
            console.log('Back button display set to:', backButton.style.display);
            const selectionDiv = document.getElementById('cloudSelection');
            selectionDiv.innerHTML = `
                <div class="cloud-option cloud-shape-5" onclick="selectCloud('‚óé', this)">
                    <img src="images/middle1.PNG" alt="‰∏≠1">   
                </div>
                <div class="cloud-option cloud-shape-6" onclick="selectCloud('‚ñ≥', this)">
                    <img src="images/middle2.PNG" alt="‰∏≠2">    
                </div>
                <div class="cloud-option cloud-shape-7" onclick="selectCloud('‚ñ°', this)">
                    <img src="images/middle3.PNG" alt="‰∏≠3">    
                </div>
                <div class="cloud-option cloud-shape-8" onclick="selectCloud('‚ô¶Ô∏é', this)">
                    <img src="images/middle4.PNG" alt="‰∏≠4">    
                </div>
            `;
            if (selectedSecondCloud) {
                const cloudShapes = ['‚óé', '‚ñ≥', '‚ñ°', '‚ô¶Ô∏é'];
                const selectedIndex = cloudShapes.indexOf(selectedSecondCloud);
                if (selectedIndex !== -1) {
                    const cloudOptions = document.querySelectorAll('.cloud-option');
                    selectCloud(selectedSecondCloud, cloudOptions[selectedIndex]);
                }
            }
        }
        function showThirdOptions() {
            console.log('ShowThirdOptions called');
            const decisionButton = document.getElementById('decisionButton');
            decisionButton.textContent = 'Ê±∫ÂÆö';
            decisionButton.classList.remove('complete-button', 'next-button');
            
            const selectionDiv = document.getElementById('cloudSelection');
            selectionDiv.innerHTML = `
                <div class="cloud-option cloud-shape-9" onclick="selectCloud('‚òÖ', this)">
                    <img src="images/top1.PNG" alt="‰∏ä1">   
                </div>
                <div class="cloud-option cloud-shape-10" onclick="selectCloud('‚ô°', this)">
                    <img src="images/top2.PNG" alt="‰∏ä2">    
                </div>
                <div class="cloud-option cloud-shape-11" onclick="selectCloud('‚ô™', this)">
                    <img src="images/top3.PNG" alt="‰∏ä3">    
                </div>
                <div class="cloud-option cloud-shape-12" onclick="selectCloud('‚òÜ', this)">
                    <img src="images/top4.PNG" alt="‰∏ä4">    
                </div>
            `;
            if (selectedThirdCloud) {
                const cloudShapes = ['‚òÖ', '‚ô°', '‚ô™', '‚òÜ'];
                const selectedIndex = cloudShapes.indexOf(selectedThirdCloud);
                if (selectedIndex !== -1) {
                    const cloudOptions = document.querySelectorAll('.cloud-option');
                    selectCloud(selectedThirdCloud, cloudOptions[selectedIndex]);
                }
            }
        }
        function showFourthOptions() {
            console.log('ShowFourthOptions called');
            const decisionButton = document.getElementById('decisionButton');
            decisionButton.textContent = 'ÂÆåÊàê';
            decisionButton.classList.remove('next-button');
            decisionButton.classList.add('complete-button');
            
            const selectionDiv = document.getElementById('cloudSelection');
            selectionDiv.innerHTML = `
                <div class="cloud-option cloud-shape-13" onclick="selectCloud('‚ú®', this)">
                    <img src="images/backGround1.PNG" alt="ËÉåÊôØ1">   
                </div>
                <div class="cloud-option cloud-shape-14" onclick="selectCloud('‚≠ê', this)">
                    <img src="images/backGround2.PNG" alt="ËÉåÊôØ2">    
                </div>
                <div class="cloud-option cloud-shape-15" onclick="selectCloud('üí´', this)">
                    <img src="images/backGround3.PNG" alt="ËÉåÊôØ3">    
                </div>
                <div class="cloud-option cloud-shape-16" onclick="selectCloud('üåü', this)">
                    <img src="images/backGround4.PNG" alt="ËÉåÊôØ4">    
                </div>
            `;
            if (selectedFourthCloud) {
                const cloudShapes = ['‚ú®', '‚≠ê', 'üí´', 'üåü'];
                const selectedIndex = cloudShapes.indexOf(selectedFourthCloud);
                if (selectedIndex !== -1) {
                    const cloudOptions = document.querySelectorAll('.cloud-option');
                    selectCloud(selectedFourthCloud, cloudOptions[selectedIndex]);
                }
            } else {
                selectCloud('‚ú®', document.querySelector('.cloud-option'));
            }
        }
        function showFirstOptions() {
            const decisionButton = document.getElementById('decisionButton');
            decisionButton.textContent = 'Ê±∫ÂÆö';
            decisionButton.classList.remove('complete-button');
            const backButton = document.getElementById('backButton');
            backButton.style.display = 'none';
            console.log('Back button hidden');
            document.getElementById('overlayCloud').style.display = 'none';
            document.getElementById('overlayCloud2').style.display = 'none';
            document.getElementById('backGround').style.display = 'none';
            const selectionDiv = document.getElementById('cloudSelection');
            selectionDiv.innerHTML = `
                <div class="cloud-option cloud-shape-1" onclick="selectCloud('‚òÅ‚òÅ‚òÅ', this)">
                    <img src="images/bottom1.PNG" alt="‰∏ã1">   
                </div>
                <div class="cloud-option cloud-shape-2" onclick="selectCloud('‚òÅ‚òÅ‚òÅ‚òÅ', this)">
                    <img src="images/bottom2.PNG" alt="‰∏ã2">    
                </div>
                <div class="cloud-option cloud-shape-3" onclick="selectCloud('‚óè ‚óè ‚óè', this)">
                    <img src="images/bottom3.PNG" alt="‰∏ã3">    
                </div>
                <div class="cloud-option cloud-shape-4" onclick="selectCloud('‚óê', this)">
                    <img src="images/bottom4.PNG" alt="‰∏ã4">    
                </div>
            `;
            if (selectedFirstCloud && selectedFirstImage) {
                const mainCloud = document.getElementById('mainCloud');
                mainCloud.innerHTML = `<img src="${selectedFirstImage}" alt="${selectedFirstCloud}" style="max-width: 100%; max-height: 100%; object-fit: contain;">`;
                mainCloud.classList.add('selected-shape');
                const cloudOptions = document.querySelectorAll('.cloud-option');
                const cloudShapes = ['‚òÅ‚òÅ‚òÅ', '‚òÅ‚òÅ‚òÅ‚òÅ', '‚óè ‚óè ‚óè', '‚óê'];
                const selectedIndex = cloudShapes.indexOf(selectedFirstCloud);
                if (selectedIndex !== -1) {
                    cloudOptions.forEach(option => option.classList.remove('selected'));
                    cloudOptions[selectedIndex].classList.add('selected');
                }
            } else {
                const mainCloud = document.getElementById('mainCloud');
                mainCloud.textContent = 'Â•Ω„Åç„Å™ÂΩ¢„ÇíÈÅ∏„Çì„Åß„Å≠';
                mainCloud.classList.remove('selected-shape');
            }
        }
        window.onload = function() {
            console.log('Page loaded');
            document.getElementById('mainCloud').textContent = 'Â•Ω„Åç„Å™ÂΩ¢„ÇíÈÅ∏„Çì„Åß„Å≠';
            const backButton = document.getElementById('backButton');
            console.log('Back button  exists:', backButton !== null);
        }
    </script>    
    <script src="original.js"></script>
</body>
</html>